<Welcome>:
    name: "welcome"
    md_bg_color: app.theme_cls.primary_color
    MDBoxLayout:
        orientation: "vertical"
        MDLabel:
            text: "Welcome to Green Screen Emulator"
            halign: "center"
            font_size: "50sp"
            bold: True
        MDBoxLayout:
            padding: "15sp"
            spacing: "15sp"
            size_hint_y: None
            height: self.minimum_height + sp(50)
            AnchorLayout:
                MDFlatButton:
                    text: "Open the last project"
                    on_release: app.change("advanced")
                    font_size: "20sp"
            AnchorLayout:
                MDFlatButton:
                    text: "Upload new source"
                    on_release: app.file_manager_open()
                    on_release: app.go_to = ["ready", "time", "background"]
                    font_size: "20sp"

<Background>
    name: "background"
    md_bg_color: app.theme_cls.primary_color
    MDBoxLayout:
        orientation: "vertical"
        MDLabel:
            text: "Which should be the new background to the file?"
            halign: "center"
            font_size: "30sp"
        MDLabel:
            text: app.ctrl.input
            halign: "center"
            font_size: "30sp"
            bold: True
        MDBoxLayout:
            padding: "15sp"
            spacing: "15sp"
            size_hint_y: None
            height: self.minimum_height + sp(60)
            AnchorLayout:
                MDFlatButton:
                    text: "No one (export the mask)"
                    on_release: app.ctrl.background = ""
                    on_release: app.change()
                    font_size: "20sp"
            AnchorLayout:
                MDFlatButton:
                    text: "Color"
                    on_release: app.change("colors")
                    font_size: "20sp"
            AnchorLayout:
                MDFlatButton:
                    text: "Image/Video"
                    on_release: app.file_manager_open()
                    font_size: "20sp"

<Colors>
    name: "colors"
    md_bg_color: cp.color[0], cp.color[1], cp.color[2], 1
    MDBoxLayout:
        orientation: "vertical"
        padding: "15sp"
        spacing: "15sp"
        MDLabel:
            text: "Note alpha channel is not supported"
            halign: "center"
            font_size: "30sp"
            adaptive_height: True
        ColorPicker:
            id: cp
            color: 0, 1, 0, 1
    AnchorLayout:
        padding: "10sp"
        anchor_x: "right"
        anchor_y: "bottom"
        MDFloatingActionButton:
            icon: "check"
            on_release: app.change()
            on_release: app.ctrl.background = [c * 255 for c in [cp.color[0], cp.color[1], cp.color[2]]]

<Time>
    name: "time"
    md_bg_color: app.theme_cls.primary_color
    MDBoxLayout:
        orientation: "vertical"
        MDLabel:
            text: "How fast should be the processing to the new background:"
            halign: "center"
            font_size: "30sp"
        MDLabel:
            text: str(app.ctrl.background) if app.ctrl.background != "" else "no one"
            halign: "center"
            font_size: "30sp"
            bold: True
        MDBoxLayout:
            padding: "15sp"
            spacing: "15sp"
            size_hint_y: None
            height: self.minimum_height + sp(60)
            AnchorLayout:
                MDFlatButton:
                    text: "Default"
                    on_release: app.change()
                    font_size: "20sp"
            AnchorLayout:
                MDFlatButton:
                    text: "Choose a deadline"
                    on_release: app.show_date_picker()
                    font_size: "20sp"
            AnchorLayout:
                MDFlatButton:
                    text: "Go to advanced options"
                    on_release: app.change("advanced")
                    font_size: "20sp"

<Ready>
    name: "ready"
    md_bg_color: app.theme_cls.primary_color
    MDLabel:
        text: "Everything ready"
        halign: "center"
        font_size: "50sp"
        bold: True
    MDBoxLayout:
        padding: "20sp"
        spacing: "15sp"
        MDBoxLayout:
            orientation: "vertical"
            adaptive_height: True
            MDLabel:
                text: "Folder:"
                halign: "center"
            AnchorLayout:
                MDRaisedButton:
                    md_bg_color: app.theme_cls.accent_color
                    text_color: 0, 0, 0, 1
                    text: app.ctrl.output_dir if app.ctrl.output_dir != "" else "select one"
                    on_release: app.file_manager_open()
                    font_size: "20sp"
        MDBoxLayout:
            orientation: "vertical"
            adaptive_height: True
            MDLabel:
                text: "File name and extension:"
                halign: "center"
            AnchorLayout:
                MDTextField:
                    hint_text: app.ctrl.output_name + "." + app.ctrl.extension
                    on_text: app.ready_output(self)
                    mode: "rectangle"
                    color_mode: 'custom'
                    line_color_focus: 0, 0, 0, 1
                    line_color_normal: 0, 0, 0, 1
                    font_size: "20sp"
        MDBoxLayout:
            orientation: "vertical"
            adaptive_height: True
            MDLabel:
                text: "Start!"
                halign: "center"
            AnchorLayout:
                MDIconButton:
                    md_bg_color: app.theme_cls.accent_color
                    icon: "play"

<Advanced>
    name: "advanced"
    md_bg_color: app.theme_cls.primary_color
    MDBoxLayout:
        MDBoxLayout:
            orientation: "vertical"
            MDBoxLayout:
                MDBoxLayout:
                    id: video_codec
                    orientation: "vertical"
                    MDLabel:
                        text: "video_codec"
                        halign: "center"
                    AnchorLayout:
                        MDRaisedButton:
                            id: video_codec_button
                            md_bg_color: app.theme_cls.accent_color
                            text_color: 0, 0, 0, 1
                            text: app.ctrl.video_codec if app.ctrl.video_codec else "default"
                            on_release: app.video_codec_menu.open()
                MDBoxLayout:
                    id: audio_codec
                    orientation: "vertical"
                    MDLabel:
                        text: "audio_codec"
                        halign: "center"
                    AnchorLayout:
                        MDRaisedButton:
                            id: audio_codec_button
                            md_bg_color: app.theme_cls.accent_color
                            text_color: 0, 0, 0, 1
                            text: app.ctrl.audio_codec if app.ctrl.audio_codec else "default"
                            on_release: app.audio_codec_menu.open()
                MDBoxLayout:
                    id: compression
                    orientation: "vertical"
                    MDLabel:
                        text: "compression"
                        halign: "center"
                    AnchorLayout:
                        MDRaisedButton:
                            id: compression_button
                            md_bg_color: app.theme_cls.accent_color
                            text_color: 0, 0, 0, 1
                            text: app.ctrl.compression
                            on_release: app.compression_menu.open()
                MDBoxLayout:
                    id: scaler
                    orientation: "vertical"
                    MDLabel:
                        text: "scaler"
                        halign: "center"
                    AnchorLayout:
                        MDRaisedButton:
                            id: scaler_button
                            md_bg_color: app.theme_cls.accent_color
                            text_color: 0, 0, 0, 1
                            text: app.ctrl.scaler
                            on_release: app.scaler_menu.open()
                MDBoxLayout:
                    orientation: "vertical"
                    MDLabel:
                        text: "background"
                        halign: "center"
                    AnchorLayout:
                        MDRaisedButton:
                            md_bg_color: app.theme_cls.accent_color
                            text_color: 0, 0, 0, 1
                            text: str(app.ctrl.background) if app.ctrl.background != "" else "no one"
                            on_release: app.go_to = ["advanced"]
                            on_release: app.change("background")
                MDBoxLayout:
                    id: mask
                    orientation: "vertical"
                    MDLabel:
                        text: "mask"
                        halign: "center"
                    AnchorLayout:
                        MDRaisedButton:
                            id: mask_button
                            md_bg_color: app.theme_cls.accent_color
                            text_color: 0, 0, 0, 1
                            text: app.ctrl.mask if app.ctrl.mask != "" else "A.I."
                            on_release: app.mask_menu.open()
            MDBoxLayout:
                MDLabel:
                    text: "relative_mask_resolution"
                    halign: "center"
                MDSlider:
                    min: 0
                    max: 100
                    value: app.ctrl.relative_mask_resolution
                    color: app.theme_cls.accent_color
                    on_value: app.ctrl.relative_mask_resolution = int(self.value)
            MDBoxLayout:
                MDLabel:
                    text: "relative_mask_fps"
                    halign: "center"
                MDSlider:
                    min: 0
                    max: 100
                    value: app.ctrl.relative_mask_fps
                    color: app.theme_cls.accent_color
                    on_value: app.ctrl.relative_mask_fps = int(self.value)
            MDBoxLayout:
                MDLabel:
                    text: "monitor"
                    halign: "center"
                MDBoxLayout:
                    orientation: "vertical"
                    Monitor:
                    MDLabel:
                        text: "No"
                        halign: "center"
                MDBoxLayout:
                    orientation: "vertical"
                    Monitor:
                        op: "gui"
                    MDLabel:
                        text: "Graphically"
                        halign: "center"
                MDBoxLayout:
                    orientation: "vertical"
                    Monitor:
                        op: "bar"
                    MDLabel:
                        text: "By progress bar"
                        halign: "center"
            MDBoxLayout:
                MDLabel:
                    text: "cuda"
                    halign: "center"
                MDSwitch:
                    pos_hint: {'center_x': .5, 'center_y': .5}
                    _thumb_color_disabled: app.theme_cls.accent_color
                    active: app.ctrl.cuda
                    on_active: app.ctrl.cuda = self.active
                MDLabel:
                    id: threads_label
                    text: f"{app.ctrl.threads} threads"
                    halign: "center"
                MDIconButton:
                    icon: "chevron-up-circle-outline"
                    pos_hint: {"center_x": .5, "center_y": .5}
                    user_font_size: "36sp"
                    theme_text_color: "Custom"
                    text_color: app.theme_cls.accent_color
                    on_release: app.threads_button(True)
                MDIconButton:
                    icon: "chevron-down-circle-outline"
                    pos_hint: {"center_x": .5, "center_y": .5}
                    user_font_size: "36sp"
                    theme_text_color: "Custom"
                    text_color: app.theme_cls.accent_color
                    on_release: app.threads_button(False)
                MDLabel:
                    text: "log"
                    halign: "center"
                MDSwitch:
                    pos_hint: {'center_x': .5, 'center_y': .5}
                    _thumb_color_disabled: app.theme_cls.accent_color
                    active: app.ctrl.log
                    on_active: app.ctrl.log = self.active
        MDBoxLayout:
            orientation: "vertical"
            AnchorLayout:
                Image:
                    source: f"{app.ctrl.output_dir}{app.ctrl.output_name}.jpg"
                MDSpinner:
                    id: preview_spinner
                    color: app.theme_cls.accent_color
                    size_hint: None, None
                    size: dp(46), dp(46)
                    active: False
            MDLabel:
                text: f"preview image saved in {app.ctrl.output_dir}{app.ctrl.output_name}.jpg"
                halign: "center"
            MDBoxLayout:
                MDLabel:
                    text: "get_frame"
                    halign: "center"
                MDSlider:
                    min: 0
                    max: 100
                    value: app.ctrl.get_frame
                    color: app.theme_cls.accent_color
                    on_value: app.ctrl.get_frame = int(self.value)
            MDLabel:
                text: "Estimated time:"
                halign: "center"
            MDLabel:
                text: "TIME"
                halign: "center"
            MDProgressBar:
                value: 50
                color: app.theme_cls.accent_color
            AnchorLayout:
                MDRaisedButton:
                    md_bg_color: app.theme_cls.accent_color
                    text_color: 0, 0, 0, 1
                    text: "Ready!"
                    on_release: app.change("ready")

<Monitor@MDCheckbox>:
    group: 'monitor'
    size_hint: None, None
    size: dp(48), dp(48)
    selected_color: app.theme_cls.accent_color
    unselected_color: app.theme_cls.accent_color
    pos_hint: {'center_x': .5, 'center_y': .5}
    on_active: app.monitor_radio(self)
    active: True if self.op == app.ctrl.monitor else False
    op: None